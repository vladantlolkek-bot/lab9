<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Асинхронный JavaScript - Все задания</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:20px; background: #f0f0f0;}
header, .section { background:white; border-radius:10px; padding:20px; margin-bottom:20px; box-shadow:0 3px 6px rgba(0,0,0,0.1);}
h1 { color:#4361ee; margin-bottom:10px;}
h2 { color:#3a0ca3; margin-bottom:15px;}
button { padding:10px 20px; border:none; border-radius:5px; cursor:pointer;}
button:hover { opacity:0.9;}
.btn-primary { background:#4361ee; color:white;}
.btn-secondary { background:#4cc9f0; color:white;}
.console { background:#1e1e1e; color:#00ff00; padding:15px; border-radius:8px; height:300px; overflow-y:auto; font-family:monospace; white-space:pre-wrap; margin-bottom:10px;}
.console-line { margin-bottom:5px;}
.console-info { color:#00ff00;}
.console-success { color:#2ecc71;}
.console-warning { color:#f39c12;}
.console-error { color:#e74c3c;}
.currency-table { width:100%; border-collapse:collapse; margin-top:10px;}
.currency-table th, .currency-table td { padding:8px; border:1px solid #ccc; text-align:left;}
.currency-table th { background:#4361ee; color:white;}
.post-item { padding:10px; border-left:4px solid #4cc9f0; margin-bottom:10px; background:#f8f8f8;}
#loader { display:none; width:50px; height:50px; border:5px solid #f3f3f3; border-top:5px solid #4361ee; border-radius:50%; animation:spin 1s linear infinite; margin:10px auto;}
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
</style>
</head>
<body>
<header>
<h1>Асинхронный JavaScript</h1>
<button class="btn btn-primary" onclick="runAllTasks()">Запустить все задания</button>
<button class="btn btn-secondary" onclick="clearConsole()">Очистить консоль</button>
</header>

<div class="section">
<h2>Консоль выполнения</h2>
<div id="console" class="console"></div>
<div id="logCount">Записей: 0</div>
</div>

<div class="section">
<h2>Задание 1: Три асинхронные функции</h2>
<button class="btn btn-primary" onclick="runTask1()">Запуск последовательно</button>
<button class="btn btn-secondary" onclick="runTask1Parallel()">Запуск параллельно</button>
</div>

<div class="section">
<h2>Задание 2: JSONPlaceholder API</h2>
<button class="btn btn-primary" onclick="runTask2()">Загрузить посты</button>
<div id="posts-container"></div>
</div>

<div class="section">
<h2>Задание 3: Курсы валют</h2>
<button class="btn btn-primary" onclick="runTask3()">Получить курсы</button>
<div id="currency-container"></div>
</div>

<div id="loader"></div>

<script>
// ===== Консоль на сайте =====
let logCount = 0;
function logToConsole(msg, type='info'){
    const consoleEl = document.getElementById('console');
    const timestamp = new Date().toLocaleTimeString();
    const line = document.createElement('div');
    line.className = `console-line console-${type}`;
    line.textContent = `[${timestamp}] ${msg}`;
    consoleEl.appendChild(line);
    consoleEl.scrollTop = consoleEl.scrollHeight;
    logCount++;
    document.getElementById('logCount').textContent = `Записей: ${logCount}`;
    if(type==='error') console.error(msg); else if(type==='warning') console.warn(msg); else console.log(msg);
}
function clearConsole(){document.getElementById('console').innerHTML=''; logCount=0; document.getElementById('logCount').textContent='Записей: 0'; logToConsole('Консоль очищена','info');}
function showLoader(show=true){document.getElementById('loader').style.display=show?'block':'none';}

// ===== Задание 1 =====
async function simulateTask(name, delay){
    logToConsole(`Начало: ${name}`,'info');
    return new Promise(resolve=>{
        setTimeout(()=>{
            logToConsole(`✓ ${name} выполнена за ${delay}мс`,'success');
            resolve();
        }, delay);
    });
}
async function runTask1(){
    logToConsole('--- Последовательный запуск ---','warning');
    showLoader(true);
    try{
        await simulateTask('Задача 1',1000);
        await simulateTask('Задача 2',1500);
        await simulateTask('Задача 3',800);
        logToConsole('Все задачи выполнены последовательно','success');
    }catch(e){logToConsole(e.message,'error');}finally{showLoader(false);}
}
async function runTask1Parallel(){
    logToConsole('--- Параллельный запуск ---','warning');
    showLoader(true);
    try{
        await Promise.all([simulateTask('Задача 1',1000),simulateTask('Задача 2',1500),simulateTask('Задача 3',800)]);
        logToConsole('Все задачи выполнены параллельно','success');
    }catch(e){logToConsole(e.message,'error');}finally{showLoader(false);}
}

// ===== Задание 2 =====
async function runTask2(){
    logToConsole('--- Загрузка постов ---','warning');
    showLoader(true);
    try{
        const resp=await fetch('https://jsonplaceholder.typicode.com/posts?_limit=5');
        if(!resp.ok) throw new Error(`HTTP ошибка: ${resp.status}`);
        const posts=await resp.json();
        logToConsole(`Загружено ${posts.length} постов`,'success');
        const container=document.getElementById('posts-container'); container.innerHTML='';
        posts.forEach((post,i)=>{
            const div=document.createElement('div');
            div.className='post-item';
            div.innerHTML=`<strong>${i+1}. ${post.title}</strong><p>${post.body.substring(0,80)}...</p>`;
            container.appendChild(div);
            logToConsole(`Пост ${i+1}: ${post.title}`,'info');
        });
    }catch(e){logToConsole(`Ошибка: ${e.message}`,'error');}finally{showLoader(false);}
}

// ===== Задание 3 (fetch через Нацбанк РБ) =====
async function runTask3(){
    logToConsole('--- Курсы валют ---','warning');
    showLoader(true);
    try{
        const response = await fetch('https://www.nbrb.by/api/exrates/rates?periodicity=0');
        if(!response.ok) throw new Error('Ошибка получения данных с API Нацбанка РБ');
        const data = await response.json();
        const currencies = ['USD','EUR','RUB','PLN'];
        const container=document.getElementById('currency-container');
        let html=`<table class="currency-table"><thead><tr><th>Валюта</th><th>Официальный курс</th><th>Кратность</th></tr></thead><tbody>`;
        currencies.forEach(code=>{
            const cur = data.find(d=>d.Cur_Abbreviation===code);
            if(cur){
                html+=`<tr><td>${cur.Cur_Abbreviation} (${cur.Cur_Name})</td><td>${cur.Cur_OfficialRate.toFixed(4)}</td><td>${cur.Cur_Scale}</td></tr>`;
                logToConsole(`${cur.Cur_Abbreviation}: ${cur.Cur_OfficialRate} BYN за ${cur.Cur_Scale} ед.`, 'info');
            }
        });
        html+='</tbody></table>';
        container.innerHTML=html;
        logToConsole('Курсы валют успешно загружены','success');
    }catch(e){logToConsole(`Ошибка: ${e.message}`,'error'); document.getElementById('currency-container').innerHTML='<div>Ошибка загрузки курсов валют</div>';}
    finally{showLoader(false);}
}

// ===== Запуск всех заданий =====
async function runAllTasks(){
    logToConsole('=== ЗАПУСК ВСЕХ ЗАДАНИЙ ===','warning');
    await runTask1();
    await runTask2();
    await runTask3();
    logToConsole('Все задания выполнены!','success');
}

document.addEventListener('DOMContentLoaded',()=>{logToConsole('Страница загружена','success');});
</script>
</body>
</html>
